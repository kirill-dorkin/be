# Заказы и заявки на ремонт

Здесь описано, как обработать клиентский заказ или заявку на ремонт, какие статусы бывают и как назначить исполнителя. Все действия выполняются в разделе **Orders** панели Saleor.

## 1. Типы заказов
- **Обычный заказ** — оформлен на сайте через корзину. Оплата проходит через Stripe.
- **Заявка на ремонт (черновой заказ)** — создаётся автоматически из формы «Заказать ремонт». Содержит одну услугу и заметку о назначенном специалисте.

## 2. Фильтры и поиск
- Используйте строку поиска по номеру заказа, email клиента или имени.
- Фильтры по статусу: Draft (черновик), Unconfirmed (ожидает оплаты), Unfulfilled (нужно выполнить), Fulfilled (выполнен), Cancelled.
- Для заявок на ремонт есть фильтр по каналу `Repair Services` (значение `SERVICE_CHANNEL_SLUG`).

## 3. Обработка обычного заказа
1. Откройте заказ из списка.
2. Проверьте блок **Order details**: контакт клиента, адрес, способ доставки.
3. В разделе **Payments** убедитесь, что оплата `Authorized` или `Captured`. Если статус `Pending` — свяжитесь с клиентом.
4. Нажмите **Mark as paid** (если оплата поступила офлайн) или **Capture** (если заказ был авторизован).
5. Перейдите в блок **Fulfillment** → **Fulfill products**:
   - Выберите склад и количество отправляемых товаров.
   - Введите номер отслеживания (tracking number), если есть.
   - Нажмите **Fulfill**.
6. После отправки можно нажать **Mark as shipped**, чтобы клиент получил уведомление.

## 4. Работа с заявкой на ремонт
1. В списке заказов найдите черновик (статус `Draft`). Название услуги видно в таблице позиций.
2. Откройте заказ. В блоке **Order notes** будет приватная заметка со следующим содержанием:
   - Имя клиента и контакты.
   - Выбранная услуга и оценка стоимости.
   - Имя назначенного сотрудника (worker), если найден активный участник группы `Repair Workers`.
3. Свяжитесь с клиентом, уточните детали и подтвердите заказ:
   - Нажмите **Finalize draft** → выберите канал продаж → **Finalize**.
   - Заказ сменит статус на `Unconfirmed`.
4. Нажмите **Mark as paid** (если оплата проходит на месте) или отправьте ссылку на оплату через менеджера (Stripe invoice).
5. Когда ремонт завершён, откройте вкладку **Fulfillment**, нажмите **Fulfill products** и добавьте заметку о выполненных работах.

## 5. Назначение и управление работниками
- Работники добавляются в группу `Repair Workers` через **Configuration → Staff Members** (см. [docs/repair-services.md](https://github.com/kirill-dorkin/be/blob/main/docs/repair-services.md)).
- Если нужно переназначить заявку на другого сотрудника:
  1. Откройте заказ → вкладка **History**.
  2. Добавьте приватную заметку с именем нового специалиста.
  3. Сообщите изменённое назначение в командный чат.
- При отсутствии свободных работников поставьте заявку в статус `On hold` (создайте дополнительный тег или используйте заметку).

## 6. Возвраты и отмены
- Нажмите **Void payment** или **Refund** в зависимости от статуса оплаты.
- Добавьте заметку с причиной возврата.
- Если заказ ещё не подтверждён, можно нажать **Delete draft** — заказ исчезнет.

## 7. Контроль качества
- Раз в неделю выгружайте отчёт (**Orders → Export orders**) для контроля SLA.
- Проверяйте, что все черновики старше 2 дней обработаны.
- Следите за заметками: каждая заявка должна содержать результат общения с клиентом.

## 8. Частые проблемы
| Ситуация | Что делать |
| --- | --- |
| Оплата зависла в статусе `Pending` | Проверьте Stripe Dashboard, свяжитесь с клиентом. Можно повторно отправить ссылку на оплату. |
| Нет назначенного работника | Проверьте группу `Repair Workers` — есть ли активные сотрудники. Добавьте вручную заметку с исполнителем. |
| Клиент хочет изменить услугу | Отредактируйте позиции в черновом заказе перед финализацией или создайте новый заказ. |
| Не приходит письмо клиенту | Убедитесь, что заказ подтверждён и выполнено действие (например, `Fulfill`). Если проблема сохраняется — обратитесь в поддержку. |

Если нужна помощь, обращайтесь к руководителю сервисного отдела или создайте задачу в системе поддержки с номером заказа.

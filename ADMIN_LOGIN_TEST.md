# Тестирование автоматического перенаправления администратора

## Созданный администратор
- **Email:** admin@be.kg
- **Пароль:** admin123
- **Роль:** admin

## Как протестировать

### 1. Тест автоматического перенаправления при логине
1. Откройте http://localhost:3000/login
2. Введите данные администратора:
   - Email: admin@be.kg
   - Пароль: admin123
3. Нажмите "Войти"
4. **Ожидаемый результат:** Автоматическое перенаправление на `/admin/dashboard`

### 2. Тест защиты admin роутов
1. Откройте http://localhost:3000/admin/dashboard (без авторизации)
2. **Ожидаемый результат:** Перенаправление на `/login?callbackUrl=/admin/dashboard`
3. После логина как администратор - перенаправление обратно на dashboard

### 3. Тест перенаправления с главной страницы
1. Войдите как администратор
2. Откройте http://localhost:3000/
3. **Ожидаемый результат:** Автоматическое перенаправление на `/admin/dashboard`

### 4. Тест функциональности dashboard
После входа как администратор, проверьте доступность всех разделов:
- ✅ Главная (метрики)
- ✅ Пользователи
- ✅ Задачи
- ✅ Услуги
- ✅ Категории
- ✅ Устройства
- ✅ Сотрудники

## Возможные проблемы и решения

### Если администратор не создался

```bash
node scripts/create-admin.mjs
```

### Если есть ошибки в консоли
Проверьте переменные окружения в `.env.local`:
- MONGODB_URI
- NEXTAUTH_SECRET
- NEXTAUTH_URL

### Если перенаправление не работает
1. Очистите cookies браузера
2. Перезапустите сервер разработки
3. Проверьте, что middleware.ts работает корректно

## Архитектура решения

### Компоненты системы перенаправления:
1. **middleware.ts** - защищает admin роуты
2. **src/auth.ts** - содержит redirect callback для NextAuth
3. **src/app/login/page.tsx** - логика перенаправления после логина
4. **src/app/page.tsx** - автоматическое перенаправление с главной страницы

### Логика работы:
1. Пользователь заходит на admin роут → middleware проверяет авторизацию
2. Если не авторизован → перенаправление на login с callbackUrl
3. После успешного логина → проверка роли пользователя
4. Если admin → перенаправление на dashboard или callbackUrl (если это admin роут)
5. Если обычный пользователь → перенаправление на главную страницу